language: go
go:
  - 1.7.x
  - 1.8.x
  - tip

matrix:
  allow_failures:
    - go: tip

go_import_path: github.com/opencontainers/runc

# `make ci` uses Docker.
sudo: required
services:
  - docker

env:
  global:
    - BUILDTAGS="seccomp apparmor selinux ambient"

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y libseccomp-dev libapparmor-dev
  - go get -u github.com/golang/lint/golint
  - go get -u github.com/vbatts/git-validation
  - sudo wget https://github.com/mvdan/sh/releases/download/v1.3.1/shfmt_v1.3.1_linux_amd64 -O /usr/local/bin/shfmt
  - echo -n "4cdb7b24f5de623ad5d691f826ada61b4390a1c0c7dc1ef8414a5e9c1755f7c7 /usr/local/bin/shfmt" | sha256sum -c
  - chmod +x /usr/local/bin/shfmt
  - env | grep TRAVIS_

script:
  - git-validation -run DCO,short-subject -v
  - make BUILDTAGS="${BUILDTAGS}"
  - make BUILDTAGS="${BUILDTAGS}" clean validate test
